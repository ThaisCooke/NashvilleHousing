-- Cleaning Data in SQL Queries

SELECT * 
FROM master.dbo.NashvilleHousing 

-- Standardized Sale Format

SELECT SaleDateConverted, CONVERT (Date,SaleDate)
FROM master.dbo.NashvilleHousing 

UPDATE master.dbo.NashvilleHousing
SET SaleDate = CONVERT (Date,SaleDate)

ALTER TABLE master.dbo.NashVilleHousing
ADD SaleDateConverted Date

UPDATE NashvilleHousing
SET SaleDateConverted = CONVERT (Date,SaleDate)


-- Populate Property Address Data

SELECT *
FROM master.dbo.NashvilleHousing 
--Where PropertyAddress IS NULL
ORDER BY ParcelID


SELECT a.ParcelId, a.PropertyAddress, b.ParcelID, b.PropertyAddress, ISNULL (a.PropertyAddress, b.Propertyaddress)
FROM master.dbo.NashvilleHousing a
JOIN master.dbo.NashvilleHousing b
ON a.ParcelId = b.ParcelId
AND a.UniqueID <> b.UniqueID
WHERE a.PropertyAddress IS NULL

UPDATE a
SET PropertyAddress = ISNULL (a.PropertyAddress, b.Propertyaddress)
FROM master.dbo.NashvilleHousing a
JOIN master.dbo.NashvilleHousing b
ON a.ParcelId = b.ParcelId
AND a.UniqueID <> b.UniqueID
WHERE a.PropertyAddress IS NULL


-- Breaking out address into Individual Columns (Address, City, State)

SELECT Propertyaddress
FROM master.dbo.NashvilleHousing 
--Where PropertyAddress IS NULL
--ORDER BY ParcelID

SELECT 
SUBSTRING (PropertyAddress, 1, CHARINDEX (',', PropertyAddress) - 1) as Address
,SUBSTRING (PropertyAddress, CHARINDEX (',', PropertyAddress) + 1, LEN(PropertyAddress)) as Address
FROM master.dbo.NashvilleHousing 

ALTER TABLE master.dbo.NashvilleHousing 
ADD PropertySplitAddress Nvarchar (255);

UPDATE master.dbo.NashvilleHousing 
SET PropertySplitAddress = SUBSTRING (PropertyAddress, 1, CHARINDEX (',', PropertyAddress) - 1) 

ALTER TABLE master.dbo.NashvilleHousing 
ADD PropertySplitCity Nvarchar (255);

UPDATE master.dbo.NashvilleHousing 
SET PropertySplitCity = SUBSTRING (PropertyAddress, CHARINDEX (',', PropertyAddress) + 1, LEN (PropertyAddress)) 

SELECT *
FROM master.dbo.NashvilleHousing 


-- Breaking out address into Individual Columns (Address, City, State) Using Parsename

SELECT OwnerAddress
FROM master.dbo.NashvilleHousing 

SELECT 
PARSENAME(REPLACE(OwnerAddress, ',', '.'), 3)
,PARSENAME (REPLACE(OwnerAddress, ',', '.'), 2)
,PARSENAME (REPLACE(OwnerAddress, ',', '.'), 1)
FROM master.dbo.NashvilleHousing 

ALTER TABLE master.dbo.NashvilleHousing 
ADD OwnerSplitAddress Nvarchar (255);

UPDATE master.dbo.NashvilleHousing 
SET OwnerSplitAddress = PARSENAME(REPLACE(OwnerAddress, ',', '.'), 3)

ALTER TABLE master.dbo.NashvilleHousing 
ADD OwnerSplitCity Nvarchar (255);

UPDATE master.dbo.NashvilleHousing 
SET OwnerSplitCity = PARSENAME(REPLACE(OwnerAddress, ',', '.'), 2)

ALTER TABLE master.dbo.NashvilleHousing 
ADD OwnerSplitState Nvarchar (255);

UPDATE master.dbo.NashvilleHousing 
SET OwnerSplitState = PARSENAME(REPLACE(OwnerAddress, ',', '.'), 1)

SELECT *
FROM master.dbo.NashvilleHousing 


-- CHANGE Y and N to YES and NO in "Sold as Vacant" field

SELECT DISTINCT(SoldAsVacant), COUNT(SoldAsVacant)
FROM master.dbo.NashvilleHousing
GROUP BY SoldAsVacant
ORDER BY 2

SELECT SoldAsVacant,
CASE WHEN SoldAsVacant = 'Y' Then 'Yes'
WHEN SoldAsVacant = 'N' THEN 'No'
ELSE SoldAsVacant
END
FROM  master.dbo.NashvilleHousing

UPDATE  master.dbo.NashvilleHousing
SET SoldAsVacant =
CASE WHEN SoldAsVacant = 'Y' Then 'Yes'
WHEN SoldAsVacant = 'N' THEN 'No'
ELSE SoldAsVacant
END
FROM  master.dbo.NashvilleHousing
